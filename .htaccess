### LITESPEED / HOSTINGER ULTIMATE CORS FIX V13 (THE SINGULAR TRUTH) ###
# Place this file in your /public_html/api/ directory

# 1. ATOMIC PREFLIGHT INTERCEPTION
# Intercept OPTIONS and exit with 200 OK. 
# Some LiteSpeed firewalls prefer 200 over 204 or 201 to properly pass the handshake.
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ - [R=200,L]
</IfModule>

# 2. THE SINGULAR CORS POLICY
# To prevent "Multiple Access-Control-Allow-Origin" errors, we use 'set' 
# which replaces existing headers instead of 'add' which appends them.
<IfModule mod_headers.c>
    # We apply to 'always' to cover preflights (200/204) and errors (4xx/5xx).
    # We also apply to the default table to be absolutely certain we override any PHP-level headers.
    
    Header set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Origin "*"
    
    Header set Access-Control-Allow-Methods "GET, POST, OPTIONS, PUT, DELETE"
    Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS, PUT, DELETE"
    
    Header set Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept, Authorization, Cache-Control, Pragma"
    Header always set Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept, Authorization, Cache-Control, Pragma"
    
    Header set Access-Control-Allow-Credentials "false"
    Header always set Access-Control-Allow-Credentials "false"
    
    Header set Access-Control-Max-Age "86400"
    Header always set Access-Control-Max-Age "86400"
</IfModule>

# 3. MODSECURITY / WAF BYPASS
# Prevents Hostinger's Firewall from blocking POST requests with JSON payloads.
<IfModule mod_security.c>
    SecFilterEngine Off
    SecFilterScanPOST Off
</IfModule>
<IfModule mod_security2.c>
    SecRuleEngine Off
</IfModule>

# 4. CACHE CONTROL
<IfModule mod_headers.c>
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires 0
</IfModule>

# 5. SECURITY
Options -Indexes